# Zabbix Agent 2 Configuration File

# Hostname - должно совпадать с тем, что в docker-compose.yml
Hostname=ubuntu25

# Сервер Zabbix
Server=zabbix-server
ServerActive=zabbix-server

# Порт для пассивных проверок
ListenPort=10050

# Путь к логам
LogType=console

# Уровень логирования (0-5)
DebugLevel=3

# Таймаут (в секундах)
Timeout=30

# Разрешить удаленные команды (для Zabbix Agent 2)
AllowKey=system.run[*]

# Системные плагины для расширенного мониторинга
Plugins.SystemRun.LogRemoteCommands=1

# Docker мониторинг
Plugins.Docker.Endpoint=unix:///var/run/docker.sock

# Системные метрики с учетом host namespace
Plugins.SystemRun.LogRemoteCommands=1

# Кастомные параметры для мониторинга host системы
# Встроенные метрики system.cpu.*, vm.memory.*, vfs.fs.*, system.uptime уже есть в Agent 2

# Статус сервисов (systemd) - если доступен
UserParameter=systemd.service.status[*],systemctl is-active $1 2>/dev/null || echo "unknown"

# Docker контейнеры
UserParameter=docker.containers.running,docker ps -q 2>/dev/null | wc -l || echo 0
UserParameter=docker.containers.total,docker ps -a -q 2>/dev/null | wc -l || echo 0

# Температура CPU (если доступно)
UserParameter=sensor.temp.cpu,cat /sys/class/thermal/thermal_zone0/temp 2>/dev/null | awk '{print $1/1000}' || echo 0

